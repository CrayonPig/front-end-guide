(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{357:function(s,a,n){"use strict";n.r(a);var t=n(10),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"基础搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础搭建"}},[s._v("#")]),s._v(" 基础搭建")]),s._v(" "),a("p",[s._v("基于此前 "),a("RouterLink",{attrs:{to:"/monitor/framework-sdk.html"}},[s._v("SDK架构")]),s._v(" 我们整理的内容，本次SDK将采用"),a("code",[s._v("Lerna")]),s._v("作为管理多包工具，"),a("code",[s._v("Rollup")]),s._v("作为构建工具")],1),s._v(" "),a("h2",{attrs:{id:"lerna"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lerna"}},[s._v("#")]),s._v(" Lerna")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.lernajs.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Lerna"),a("OutboundLink")],1),s._v(" 是一个管理工具，用于管理包含多个软件包（package）的 JavaScript 项目。")]),s._v(" "),a("h3",{attrs:{id:"初始化项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化项目"}},[s._v("#")]),s._v(" 初始化项目")]),s._v(" "),a("p",[s._v("建议将Lerna 安装到全局环境中")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" lerna\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("我这里安装完后，lerna版本是V6.6.2，接下来我们使用lerna进行初始化项目")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" beaconify "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" beaconify\nlerna init\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("你的目录结构应该是如下结构：")]),s._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[s._v("- beaconify/\n  - packages/\n  - package.json\n  - lerna.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[a("p",[a("code",[s._v("packages")]),s._v(" 是 存放子包的目录，由 package.json 中的 workspaces 字段指定路径，也可以在"),a("code",[s._v("lerna.json")]),s._v(" 中指定，默认为 packages")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("lerna.json")]),s._v("  是 lerna 项目的配置文件，它包含了多个子包的配置信息。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("$schema")]),s._v("：SON Schema 的一个关键字，用于指定当前 JSON 文件的架构（schema）文件。")]),s._v(" "),a("li",[a("code",[s._v("packages")]),s._v("：指定存放子包的目录，默认为 packages。")]),s._v(" "),a("li",[a("code",[s._v("version")]),s._v("：指定版本号的格式，默认为 independent，表示每个子包可以有独立的版本号。当设为 fixed 时，所有子包的版本号都必须一致。")]),s._v(" "),a("li",[a("code",[s._v("npmClient")]),s._v("：指定使用的 npm 客户端，默认为 npm。")]),s._v(" "),a("li",[a("code",[s._v("command")]),s._v("：指定执行命令的方式，默认为 run，表示使用 npm script 的方式来执行命令。")]),s._v(" "),a("li",[a("code",[s._v("useWorkspaces")]),s._v("：指定是否启用 yarn workspaces 特性，默认为 false。如果设置为 true，则不需要再使用 lerna bootstrap 安装依赖，而是直接使用 yarn install 安装即可。")]),s._v(" "),a("li",[a("code",[s._v("npmClientArgs")]),s._v("：指定传递给 npm 客户端的额外参数。")]),s._v(" "),a("li",[a("code",[s._v("ignore")]),s._v("：指定忽略的文件或目录，支持 glob 匹配。")])])])]),s._v(" "),a("h3",{attrs:{id:"添加子包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加子包"}},[s._v("#")]),s._v(" 添加子包")]),s._v(" "),a("p",[s._v("为方便后续环境的搭建，我们这里先新建两个子包 "),a("code",[s._v("core")]),s._v(" 和 "),a("code",[s._v("utils")]),s._v("，以 "),a("code",[s._v("core")]),s._v("包为例，先执行命令")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("lerna create core\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("会出现提示让你填写一些资料，我们可以一路回车创建完毕后，手动在子包的 "),a("code",[s._v("package.json")]),s._v("中更改，也可以在创建过程中填写")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 填写包名")]),s._v("\npackage name: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" @beaconify/core \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本号")]),s._v("\nversion: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 描述")]),s._v("\ndescription: \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关键词 ")]),s._v("\nkeywords: \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主页")]),s._v("\nhomepage: \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开源协议")]),s._v("\nlicense: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ISC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" MIT\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 入口文件")]),s._v("\nentry point: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lib/index.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 绑定的git仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" repository: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https://github.com/CrayonPig/beaconify.git"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("创建完毕后，目录结构如下")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("- packages\n  - core\n    - __tests__ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试用例")]),s._v("\n      - core.test.js\n    - lib "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代码目录")]),s._v("\n      - core.js "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 入口")]),s._v("\n    - package.json\n    - README.md\n- lerna.json\n- package.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("同样的，我们创建"),a("code",[s._v("utils")]),s._v(" 子包，并lib下的文件都对应"),a("code",[s._v("package.json")]),s._v(" 中的 "),a("code",[s._v("main")]),s._v(" 入口文件字段的内容，将文件名重命名为index.js")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("- packages\n  - core\n    - __tests__ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试用例")]),s._v("\n      - core.test.js\n    - lib "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代码目录")]),s._v("\n      - index.js "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 入口")]),s._v("\n    - package.json\n    - README.md\n  - utils\n    - __tests__ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试用例")]),s._v("\n      - utils.test.js\n    - lib "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代码目录")]),s._v("\n      - index.js "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 入口")]),s._v("\n    - package.json\n    - README.md\n- lerna.json\n- package.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"子包调用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#子包调用"}},[s._v("#")]),s._v(" 子包调用")]),s._v(" "),a("p",[s._v("我们接下来使用 "),a("code",[s._v("core")]),s._v(" 调用 "),a("code",[s._v("utils")]),s._v("的方法，首先在根目录下为 "),a("code",[s._v("core")]),s._v("安装依赖")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("lerna "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" @beaconify/utils "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--scope")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("@beaconify/core\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("表示为 @beaconify/core 的子包中安装 @beaconify/utils 包作为运行时依赖项。")]),s._v(" "),a("p",[s._v("安装成功后，在根目录中会出现 node_modules ， 里面有 @beaconify/utils 包")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("当你在一个子包中安装依赖时，Lerna 会自动将该依赖项添加到根目录下的 package.json 文件中，并将该依赖项安装到根目录下的 node_modules 目录中。同时，Lerna 还会在当前子包中创建一个名为 node_modules 的符号链接，指向根目录下的 node_modules 目录。")])]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("core/lib/index.js")]),s._v(" 修改为如下内容")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" utils "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@beaconify/utils'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("core")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("utils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello from core'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("core")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("将 "),a("code",[s._v("utils/lib/index.js")]),s._v(" 修改为如下内容")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("utils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello from utils'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("然后通过node执行 "),a("code",[s._v("core/lib/index.js")]),s._v("，成功打印两个日志后，代表引用成功")]),s._v(" "),a("h2",{attrs:{id:"rollup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup"}},[s._v("#")]),s._v(" Rollup")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.rollupjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Rollup"),a("OutboundLink")],1),s._v("是一个 JavaScript 模块打包工具，可以将多个小的代码片段编译为完整的库和应用。常见的如"),a("code",[s._v("Vue.js")]),s._v("和"),a("code",[s._v("React.js")]),s._v("均是由 Rollup 打包构建的。")])])}),[],!1,null,null,null);a.default=e.exports}}]);